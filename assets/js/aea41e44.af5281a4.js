"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[539],{7959:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var o=s(5893),t=s(1151);const i={},r="Nodes",a={id:"Tezos-Nodes",title:"Nodes",description:"Use nodes to configure the Tezos nodes running in your chart.",source:"@site/01-Tezos-Nodes.md",sourceDirName:".",slug:"/Tezos-Nodes",permalink:"/Tezos-Nodes",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tezosK8sSidebar",previous:{title:"Accounts",permalink:"/Tezos-Accounts"},next:{title:"Signers",permalink:"/Tezos-Signers"}},c={},d=[];function l(e){const n={a:"a",code:"code",h1:"h1",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"nodes",children:"Nodes"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"nodes"})," to configure the Tezos nodes running in your chart."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"nodes"})," is a dictionary where each key/value pair defines a statefulset and a\nnumber of instances thereof. The name (key) defines the name of the\nstatefulset and will be the base of the pod names. The instances are defined\nas a list because their names are simply -N appended to the statefulsetname.\nSaid names are typically kebab case."]}),"\n",(0,o.jsx)(n.p,{children:"Params at the statefulset level:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"config"}),': The "config" property should mimic the structure of a node\'s\nconfig.json. Run ',(0,o.jsx)(n.code,{children:"octez-node config --help"})," for more info.\nIf present at the statefulset level, it overrides it in\n",(0,o.jsx)(n.code,{children:"node_globals"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"env"}),': A dictionary of containers mapped to a dictionary of env\nvars.  The container name "all" will apply the env vars to\nall containers.  The most specific wins.  Find the names of\nthe containers by examining an installed environment, or by\nlooking at charts/tezos/templates/nodes.yaml.  Please note\nthat we truncate the protocol from the container name for\nbakers and accusers, so "baker-011-pthangz2" is configured\nusing just "baker".']}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"storage_size"}),": The size of the PV."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"resources"}),": Resources specifications for the node.\nOptionally set resources and limits for octez node\nSee: ",(0,o.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/",children:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"images"}),': Optional specification of images to use for the tezos node and\nbaker. Options are "octez" with a tezos/tezos image.\nIf no images are provided, the containers will default to the images\ndefined in the "images" field up above.']}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"runs"}),": A list of containers to run.\nOptions being ",(0,o.jsx)(n.code,{children:"octez_node"}),", ",(0,o.jsx)(n.code,{children:"accuser"}),", ",(0,o.jsx)(n.code,{children:"baker"}),", ",(0,o.jsx)(n.code,{children:"logger"})," and ",(0,o.jsx)(n.code,{children:"vdf"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"local_storage"}),": Use local storage instead of a volume. The storage will be\nwiped when the node restarts for any reason. Useful when\nfaster IO is desired. Defaults to false."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"local_storage_pv_size"}),": The size of the persistent volume to store ",(0,o.jsx)(n.code,{children:"identity.json"}),"\nand ",(0,o.jsx)(n.code,{children:"peers.json"})," when ",(0,o.jsx)(n.code,{children:"local_storage"})," is enabled. Some cloud\nproviders have minimum pv size requirements for which this\nvalue can be used. Default value is 1Gi."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"labels"}),": ",(0,o.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/",children:"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/"}),"\nNOTE: the labels ",(0,o.jsx)(n.code,{children:"appType"}),", ",(0,o.jsx)(n.code,{children:"node_class"}),", and ",(0,o.jsx)(n.code,{children:"baking_node"})," are set\nautomatically for you."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node_selector"}),": Specify a kubernetes node selector in ",(0,o.jsx)(n.code,{children:"key: value"})," format\nfor your tezos nodes."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"rpc_readiness_probe"}),": Attach a probe to the node. The probe checks whether\nthe RPC service is responsive, which should always be the\ncase. Defaults to true."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bootstrapped_readiness_probe"}),": Checks whether the most recent block is less than\n600 seconds old.\nOverrides ",(0,o.jsx)(n.code,{children:"rpc_readiness_probe"}),". Defaults to True.\nTrue is good for RPC nodes, private nodes, and\nself-contained private chains.\nRecommended to set to False when bootstrapping a new\nchain with external bakers, such as a new test chain.\nOtherwise, the chain may become unreachable externally\nwhile waiting for other nodes to come online."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bootstrapped_startup_probe"}),": Adds additional startup probe to check checks\nwhether the most recent block is less than 600 seconds old.\nDefaults to False."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bootstrapped_liveness_probe"}),": Adds additional liveness probe to check checks\nwhether the most recent block is less than 600 seconds old.\nDefaults to False."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"instances"}),": A list of nodes to fire up, each is a dictionary defining:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bake_using_accounts"}),": List of account names that should be used for baking."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"authorized_keys"}),": List of account names that should be used as keys to\nauthenticate a baker to a signer.\nWhen a baker uses a remote signer that requires\nauthentication, the relevant key from this list\nwill be used to sign every signature request."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"config"}),": Same as the outer statefulset level ",(0,o.jsx)(n.code,{children:"config"}),". It overrides the\nstatefulset level."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"is_bootstrap_node"}),": Boolean for is this node a bootstrap peer."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"identity"}),": An optional map containing a pre-generated Tezos node\nidentity. The identity file will be created at\n/var/tezos/node/data/identity.json.\nRequired fields are ",(0,o.jsx)(n.code,{children:"peer_id"}),", ",(0,o.jsx)(n.code,{children:"public_key"}),", ",(0,o.jsx)(n.code,{children:"secret_key"}),",\nand ",(0,o.jsx)(n.code,{children:"proof_of_work_timestamp"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Defaults are filled in for most of the above values.  You can also provide\nglobal defaults for all nodes via a ",(0,o.jsx)(n.code,{children:"node_globals"})," section which is also\na dictionary.  Currently, two keys are defined: ",(0,o.jsx)(n.code,{children:"config"})," and ",(0,o.jsx)(n.code,{children:"env"}),".  These\noperate in the same way as the section in ",(0,o.jsx)(n.code,{children:"nodes"})," going by the same name."]}),"\n",(0,o.jsx)(n.p,{children:"Example config:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'node_globals:\n  config:\n    shell:\n      history_mode: full\n  env:\n    baker:\n      TEZOS_LOG: "* -> debug"\nnodes:\n  rolling-baking-node:\n    config:\n      shell:\n        history_mode: rolling\n    env:\n      all:\n        TEZOS_CLIENT_UNSAFE_DISABLE_DISCLAIMER: "Y"\n      snapshot-downloader:\n        HTTP_PROXY: http://my-proxy.my-company.com:3128/\n    labels:\n      # Example labels you might use to specify certain attributes of your nodes.\n      peer_node: "true" # Forward P2P traffic to this node types instances\n      rpc_node: "true" # Forward RPC traffic to this node types instances\n    node_selector:\n      nodeSelectorKey: nodeSelectorValue\n    storage_size: 15Gi\n    images: # (optional field)\n      octez: tezos/tezos:v...\n    local_storage: false\n    runs:\n      - octez_node\n      - baker\n    resources:\n      requests:\n        memory: 16192Mi\n      limits:\n        memory: 16192Mi\n    instances:\n      - bake_using_accounts: [baker0]\n        is_bootstrap_node: true\n        # Note the following config section overrides the above one even\n        # if we make them the same in this example.\n        config:\n          shell:\n            history_mode: rolling\n        identity:\n           peer_id: id...\n           public_key: ...\n           secret_key: ...\n           proof_of_work_stamp: ...\n  rolling-node:\n    labels:\n      # Example labels you might use to specify certain attributes of your nodes.\n      peer_node: "true"\n      rpc_node: "true"\n    images: # (optional field)\n      octez: tezos/tezos:v...\n    runs: ["octez_node"]\n    instances:\n      - {}\n      - {}\n'})}),"\n",(0,o.jsx)(n.p,{children:"The default configuration is:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'node_globals:\n  config: {}\n  env: {}\nnodes:\n  rolling-node:\n    storage_size: 100Gi\n    runs:\n      - octez_node\n    instances:\n      - is_bootstrap_node: false\n        config:\n          shell:\n            history_mode: rolling\n          metrics_addr: ["0.0.0.0:9932"]\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>r});var o=s(7294);const t={},i=o.createContext(t);function r(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);